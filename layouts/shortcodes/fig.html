

{{/* ********************************   */}}
{{/* PARAMS                             */}}
{{/* ********************************   */}}

{{- $fullsizelinks := $.Site.Params.FullSizeLinks | default "false" -}}


{{/* 0: SHORTKEY 
shortkey is the path relative to /content/_assets/images/, 
with no leading slash and only the basename, no file extension. 
Ex.: "topfolder/firstasset" is the shortkey for the asset described with /content/_assets/images/topfolder/firstasset.md
*/}}
{{- $shortkey := .Get 0 -}}           


{{/* 1: SIZE
size can be just width as unitless integer (like "800")
or as two integers separated by an x to indicate complete dimensions (like "400x200") 
*/}}
{{- $size := .Get 1 -}} 
{{- $width := $.Site.Params.ImageMaxWidth | default "800" -}}
{{- $height := "" -}}
{{- with $size -}}
    {{- if in . "x" -}}
        {{- $dims := split . "x" -}}
        {{- $width = index $dims 0 -}}
        {{- $height = index $dims (sub (len $dims) 1) -}}
    {{- else -}}
        {{- $width = . -}}
    {{- end -}}
{{- end -}}


{{/* 2: DISPLAYS 
displays can be any combination of string values: img,blockquote,cite,link,footer,aside
if none are specified, defaults to all
*/}}
{{- $displays := .Get 2 | default "img,blockquote,cite,link,footer,aside" -}}


{{/* 3: RESIZEANCHOR 
DEPRECATED, likely to be phased out as unnecessary, 
because of the responsive layout approach taken: 
  - if only a width is specified, a resize is done with dynamic height, 
    and an anchor is not needed
  - if height is also specified, a proportional crop is done, 
    and the anchor is logically always top 
only relevant for staging/production site generation
*/}}
{{- $resizeAnchor := .Get 3 | default "none" -}}
{{- if $height -}} {{- $resizeAnchor = "top" -}} {{- end -}}


{{- $ctx := dict
  "shortkey" $shortkey
  "width" $width
  "height" $height
  "displays" $displays
  "resizeAnchor" $resizeAnchor
  "fullsizelinks" $fullsizelinks
  "inner" .Inner
  "page" .Page
-}}

{{- if hugo.IsServer -}}
    {{- partial "fig-render.html" $ctx -}}
{{ else -}}
    {{- $key := printf "%s-%v-%v" $shortkey $width $height -}}
    {{- partialCached "fig-render.html" $ctx $key -}}
{{- end -}}




